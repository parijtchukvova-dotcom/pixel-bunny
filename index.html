<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Pixel Bunny Ultimate</title>
<style>
body{margin:0;overflow:hidden;background:#6ec6ff;font-family:monospace;}
canvas{display:block;}
#ui{position:fixed;bottom:10px;left:0;right:0;display:flex;justify-content:space-around;z-index:5;}
.btn{width:70px;height:70px;border-radius:50%;background:#0008;color:white;
display:flex;align-items:center;justify-content:center;font-size:30px;}
.panel{position:fixed;inset:0;background:black;color:white;display:flex;
align-items:center;justify-content:center;font-size:22px;z-index:10;flex-direction:column;}
.hud{position:fixed;top:5px;left:5px;background:#fff9;padding:6px;border-radius:6px;}
.dialog{position:fixed;bottom:100px;left:10px;right:10px;background:#000a;color:white;
padding:10px;border-radius:10px;display:none;}
</style>
</head>

<body>

<div id="menu" class="panel">PIXEL BUNNY ULTIMATE üê∞üëë<br>
<button onclick="startGame()">START ADVENTURE</button></div>

<div id="over" class="panel" style="display:none">GAME OVER<br>
<button onclick="restart()">RESTART</button></div>

<div id="win" class="panel" style="display:none">YOU SAVED THE WORLD üê∞üåç<br>
<button onclick="restart()">RESTART</button></div>

<div class="hud" id="hud"></div>
<div class="dialog" id="dialog"></div>

<canvas id="c"></canvas>

<div id="ui">
<div class="btn" id="l">‚óÄ</div>
<div class="btn" id="j">‚ñ≤</div>
<div class="btn" id="r">‚ñ∂</div>
</div>

<script>
const c=document.getElementById("c"),x=c.getContext("2d");
c.width=innerWidth;c.height=innerHeight;

let started=false,gameOver=false,win=false;
let level=1,score=0,lives=5,exp=0,quest=0;
const g=0.6;
const k={l:0,r:0,j:0};

const save=JSON.parse(localStorage.getItem("bunnySave")||"{}");
if(save.level){({level,score,lives,exp,quest}=save);}

const story=[
"–ü—Ä–∏–≤—ñ—Ç, –≥–µ—Ä–æ–π! –¢–µ–º–Ω–∏–π –º–∞–≥ –∑–∞—Ö–æ–ø–∏–≤ –ª—ñ—Å.",
"–ó–±–µ—Ä–∏ –º–æ–Ω–µ—Ç–∏ –µ–Ω–µ—Ä–≥—ñ—ó —Ç–∞ –ø–µ—Ä–µ–º–æ–∂–∏ –≤–æ—Ä–æ–≥—ñ–≤!",
"–§—ñ–Ω–∞–ª—å–Ω–∞ –±–∏—Ç–≤–∞ –ø–æ–ø–µ—Ä–µ–¥—É...",
"–¢–∏ –≤—Ä—è—Ç—É–≤–∞–≤ —Å–≤—ñ—Ç! –¢–∏ –ª–µ–≥–µ–Ω–¥–∞ üê∞üëë"
];

const levels=[
{coins:3,enemies:1},
{coins:3,enemies:2},
{coins:0,enemies:0,boss:true}
];

let coins=[],enemies=[];
const boss={x:900,y:c.height-120,w:90,h:90,hp:10,dx:2,active:false};

const player={x:50,y:c.height-120,w:30,h:40,dx:0,dy:0,ground:false};

const platforms=[
{x:0,y:c.height-40,w:2000,h:40},
{x:250,y:c.height-160,w:140,h:15},
{x:500,y:c.height-260,w:140,h:15}
];

function saveGame(){
 localStorage.setItem("bunnySave",JSON.stringify({level,score,lives,exp,quest}));
}

function spawn(){
 coins=[];
 enemies=[];
 for(let i=0;i<levels[level-1].coins;i++)
 coins.push({x:300+i*150,y:c.height-180-i*40,t:1});
 for(let i=0;i<levels[level-1].enemies;i++)
 enemies.push({x:500+i*120,y:c.height-80,w:30,h:30,dx:2+i});
 if(levels[level-1].boss) boss.active=true;
}

function dialogText(t){
 const d=document.getElementById("dialog");
 d.innerText=t;
 d.style.display="block";
 setTimeout(()=>d.style.display="none",3000);
}

function loop(){
 if(!started||gameOver||win)return;
 x.clearRect(0,0,c.width,c.height);

 x.fillStyle="#bdefff";
 x.fillRect(0,0,c.width,c.height);

 // platforms
 x.fillStyle="#654321";
 platforms.forEach(e=>x.fillRect(e.x,e.y,e.w,e.h));

 // coins
 coins.forEach(e=>{
 if(e.t){
 x.fillStyle="gold";
 x.beginPath();x.arc(e.x,e.y,6,0,Math.PI*2);x.fill();
 if(player.x<e.x+6 && player.x+player.w>e.x-6 &&
    player.y<e.y+6 && player.y+player.h>e.y-6){
    e.t=0; score++; exp+=10;
 }
 }
 });

 // enemies
 enemies.forEach(e=>{
 e.x+=e.dx;
 if(e.x<300||e.x>1000)e.dx*=-1;
 x.fillStyle="red"; x.fillRect(e.x,e.y,e.w,e.h);
 if(player.x<e.x+e.w && player.x+player.w>e.x &&
    player.y<e.y+e.h && player.y+player.h>e.y){
    lives--; player.x=50;player.y=c.height-120;
    if(lives<=0){gameOver=true;over.style.display="flex";}
 }
 });

 // boss
 if(boss.active){
 boss.x+=boss.dx;
 if(boss.x<600||boss.x>1300)boss.dx*=-1;
 x.fillStyle="purple"; x.fillRect(boss.x,boss.y,boss.w,boss.h);
 if(player.x<boss.x+boss.w && player.x+player.w>boss.x &&
    player.y<boss.y+boss.h && player.y+player.h>boss.y){
    boss.hp--; player.dy=-12;
    if(boss.hp<=0){
      win=true;
      winDiv.style.display="flex";
      localStorage.removeItem("bunnySave");
    }
 }
 }

 // physics
 if(k.l)player.dx=-4;
 else if(k.r)player.dx=4;
 else player.dx=0;

 if(k.j && player.ground){player.dy=-13;player.ground=false;}
 player.dy+=g;
 player.x+=player.dx; player.y+=player.dy;

 player.ground=false;
 platforms.forEach(e=>{
 if(player.x+player.w>e.x && player.x<e.x+e.w &&
    player.y+player.h>e.y && player.y+player.h<e.y+20){
    player.y=e.y-player.h;player.dy=0;player.ground=true;
 }});

 // bunny
 x.fillStyle="#444";
 x.fillRect(player.x,player.y,player.w,player.h);
 x.fillRect(player.x+5,player.y-15,6,15);
 x.fillRect(player.x+18,player.y-15,6,15);

 // HUD
 hud.innerHTML=`‚ù§Ô∏è ${lives} | ‚≠ê ${score} | EXP ${exp} | LVL ${level}`;

 // progression
 if(coins.every(e=>!e.t) && enemies.length===0 && !boss.active){
   level++;
   quest++;
   saveGame();
   if(level<=levels.length){
     spawn();
     dialogText(story[Math.min(quest,story.length-1)]);
   }
 }

 requestAnimationFrame(loop);
}

// controls
l.ontouchstart=()=>k.l=1; l.ontouchend=()=>k.l=0;
r.ontouchstart=()=>k.r=1; r.ontouchend=()=>k.r=0;
j.ontouchstart=()=>k.j=1; j.ontouchend=()=>k.j=0;

function startGame(){
 started=true;
 menu.style.display="none";
 spawn();
 dialogText(story[quest]);
 loop();
}

function restart(){
 localStorage.removeItem("bunnySave");
 location.reload();
}

const winDiv=document.getElementById("win");
</script>
</body>
</html>
